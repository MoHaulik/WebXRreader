<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebXR eBook Demo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.min.js"></script>
    <style>
        body { margin: 0; }
        canvas { display: block; }
        #enter-vr { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); }
    </style>
</head>
<body>
    <button id="enter-vr">Enter VR</button>
    <script>
        let scene, camera, renderer, book, pages, currentPage = 0;
        const pageContent = [
            "This is the first page of our WebXR eBook.",
            "Here's the second page. Double-click to turn pages.",
            "This is the third and final page of our demo."
        ];

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Enable WebXR
            renderer.xr.enabled = true;

            // Create book
            const geometry = new THREE.BoxGeometry(1, 1.5, 0.1);
            const material = new THREE.MeshBasicMaterial({ color: 0x8B4513 });
            book = new THREE.Mesh(geometry, material);
            scene.add(book);

            // Create pages
            pages = new THREE.Group();
            book.add(pages);

            // Add text to pages
            addTextToPages();

            // Position camera
            camera.position.z = 2;

            // Add light
            const light = new THREE.PointLight(0xffffff, 1, 100);
            light.position.set(0, 0, 10);
            scene.add(light);

            // VR button
            document.getElementById('enter-vr').addEventListener('click', onEnterVR);

            // Double-click to turn page
            renderer.domElement.addEventListener('dblclick', turnPage);

            animate();
        }

        function addTextToPages() {
            pageContent.forEach((content, index) => {
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = 256;
                canvas.height = 512;
                context.fillStyle = 'white';
                context.fillRect(0, 0, canvas.width, canvas.height);
                context.font = '20px Arial';
                context.fillStyle = 'black';
                context.fillText(content, 10, 30);

                const texture = new THREE.CanvasTexture(canvas);
                const material = new THREE.MeshBasicMaterial({ map: texture });
                const page = new THREE.Mesh(new THREE.PlaneGeometry(0.9, 1.4), material);
                page.position.set(0, 0, 0.06);  // Slightly in front of the book
                page.visible = index === 0;  // Only show the first page initially
                pages.add(page);
            });
        }

        function turnPage() {
            currentPage = (currentPage + 1) % pageContent.length;
            pages.children.forEach((page, index) => {
                page.visible = index === currentPage;
            });
        }

        function onEnterVR() {
            renderer.xr.getSession().then((session) => {
                session.addEventListener('end', onExitVR);
            });
        }

        function onExitVR() {
            // Handle exiting VR if needed
        }

        function animate() {
            renderer.setAnimationLoop(render);
        }

        function render() {
            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>
